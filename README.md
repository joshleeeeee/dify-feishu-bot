<div align="center">

# ğŸ¤– Dify Feishu Bot

**å°† Dify AI èƒ½åŠ›æ— ç¼æ¥å…¥é£ä¹¦ï¼Œæ‰“é€ ä¸“å±æ™ºèƒ½åŠ©æ‰‹**

[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)
[![Node.js](https://img.shields.io/badge/node-%3E%3D18-brightgreen.svg)](https://nodejs.org/)
[![Next.js](https://img.shields.io/badge/Next.js-15-black.svg)](https://nextjs.org/)

[English](./README.en.md) | **ä¸­æ–‡**

</div>

---

## ğŸ“– é¡¹ç›®ä»‹ç»

Dify Feishu Bot æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œè®©ä½ å¯ä»¥è½»æ¾åœ°å°† [Dify](https://dify.ai/) çš„ AI èƒ½åŠ›é›†æˆåˆ°é£ä¹¦ä¸­ã€‚é€šè¿‡ç®€å•çš„é…ç½®ï¼Œä½ çš„é£ä¹¦ç”¨æˆ·å°±å¯ä»¥ä¸ Dify æ™ºèƒ½ä½“è¿›è¡Œè‡ªç„¶è¯­è¨€å¯¹è¯ã€‚

### ğŸ¯ é€‚ç”¨åœºæ™¯

- ğŸ¢ ä¼ä¸šå†…éƒ¨æ™ºèƒ½å®¢æœ / çŸ¥è¯†åº“é—®ç­”
- ğŸ“š åŸºäºæ–‡æ¡£çš„ AI åŠ©æ‰‹
- ğŸ¤ å›¢é˜Ÿåä½œ AI å·¥å…·
- ğŸ”§ è‡ªå®šä¹‰å·¥ä½œæµè‡ªåŠ¨åŒ–

### ğŸ“¸ ç•Œé¢é¢„è§ˆ

<div align="center">

**ä»ªè¡¨ç›˜ - ç³»ç»Ÿæ¦‚è§ˆä¸å¿«é€Ÿå…¥é—¨**

![Dashboard](./docs/screenshots/dashboard.png)

**é£ä¹¦é…ç½® - WebSocket é•¿è¿æ¥æ¨¡å¼**

![Feishu Config](./docs/screenshots/feishu-config.png)

**Dify é…ç½® - API è¿æ¥è®¾ç½®**

![Dify Config](./docs/screenshots/dify-config.png)

**æ™ºèƒ½ä½“ç®¡ç† - å¤šæ™ºèƒ½ä½“é…ç½®**

![Agent Management](./docs/screenshots/agents.png)

</div>

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§ | æè¿° |
|------|------|
| ğŸ”Œ **WebSocket é•¿è¿æ¥** | æ— éœ€å…¬ç½‘ IPã€æ— éœ€åŸŸåã€æ— éœ€é…ç½® Webhook |
| ğŸ¤– **å¤šæ™ºèƒ½ä½“æ”¯æŒ** | å¯é…ç½®å¤šä¸ª AI æ™ºèƒ½ä½“ï¼Œç”¨æˆ·è‡ªç”±åˆ‡æ¢ |
| ğŸ’¬ **ä¼šè¯ç®¡ç†** | è‡ªåŠ¨ç®¡ç†å¯¹è¯ä¸Šä¸‹æ–‡ï¼Œæ”¯æŒå¤šè½®å¯¹è¯ |
| âš™ï¸ **å¯è§†åŒ–é…ç½®** | æä¾› Web ç®¡ç†é¢æ¿ï¼Œæ‰€æœ‰é…ç½®å¯è§†åŒ–æ“ä½œ |
| ğŸ”’ **å®‰å…¨è®¤è¯** | åŸºäº Token çš„ç®¡ç†é¢æ¿è®¿é—®æ§åˆ¶ |
| ğŸ“ **å¯¹è¯è®°å½•** | ä¿å­˜å®Œæ•´å¯¹è¯å†å²ï¼Œä¾¿äºè¿½æº¯ |

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     WebSocket      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é£ä¹¦å®¢æˆ·ç«¯     â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  Dify Feishu Bot â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     é•¿è¿æ¥          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                 â”‚
                                                 â”‚ HTTP API
                                                 â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚   Dify Server   â”‚
                                        â”‚   (è‡ªéƒ¨ç½²)       â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æŠ€æœ¯æ ˆï¼š**
- **è¿è¡Œæ—¶**: Node.js 18+
- **æ¡†æ¶**: Next.js 15 (App Router)
- **æ•°æ®åº“**: SQLite + Prisma ORM
- **é£ä¹¦ SDK**: @larksuiteoapi/node-sdk
- **UI**: React + Tailwind CSS

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ å·²ç»å‡†å¤‡å¥½ï¼š

- [x] Node.js 18 æˆ–æ›´é«˜ç‰ˆæœ¬
- [x] ä¸€ä¸ª [é£ä¹¦å¼€æ”¾å¹³å°](https://open.feishu.cn/) åº”ç”¨
- [x] ä¸€ä¸ªè‡ªéƒ¨ç½²çš„ [Dify](https://github.com/langgenius/dify) å®ä¾‹

### ç¬¬ä¸€æ­¥ï¼šå…‹éš†é¡¹ç›®

```bash
git clone https://github.com/joshleeeeee/dify-feishu-bot.git
cd dify-feishu-bot
```

### ç¬¬äºŒæ­¥ï¼šå®‰è£…ä¾èµ–

```bash
npm install
```

### ç¬¬ä¸‰æ­¥ï¼šåˆå§‹åŒ–æ•°æ®åº“

```bash
npx prisma generate
npx prisma db push
```

### ç¬¬å››æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œè®¾ç½®ç®¡ç†é¢æ¿çš„è®¿é—® Tokenï¼š

```bash
# ç®¡ç†é¢æ¿è®¿é—® Tokenï¼ˆè¯·ä¿®æ”¹ä¸ºä½ è‡ªå·±çš„å®‰å…¨ Tokenï¼‰
ADMIN_TOKEN=your-secure-token-here

# æ•°æ®åº“è·¯å¾„ï¼ˆé»˜è®¤å³å¯ï¼‰
DATABASE_URL="file:./dev.db"
```

### ç¬¬äº”æ­¥ï¼šå¯åŠ¨æœåŠ¡

```bash
npm run dev
```

æœåŠ¡å¯åŠ¨åï¼Œè®¿é—®ç®¡ç†é¢æ¿è¿›è¡Œé…ç½®ï¼š

```
http://localhost:3000/admin?token=your-secure-token-here
```

---

## âš™ï¸ è¯¦ç»†é…ç½®

### 1ï¸âƒ£ åˆ›å»ºé£ä¹¦åº”ç”¨

1. ç™»å½• [é£ä¹¦å¼€æ”¾å¹³å°](https://open.feishu.cn/app)
2. ç‚¹å‡»ã€Œåˆ›å»ºä¼ä¸šè‡ªå»ºåº”ç”¨ã€
3. å¡«å†™åº”ç”¨åç§°å’Œæè¿°
4. è¿›å…¥åº”ç”¨ï¼Œè·å– **App ID** å’Œ **App Secret**

### 2ï¸âƒ£ é…ç½®åº”ç”¨æƒé™

åœ¨ã€Œæƒé™ç®¡ç†ã€ä¸­æ·»åŠ ä»¥ä¸‹æƒé™ï¼š

| æƒé™ | è¯´æ˜ |
|------|------|
| `im:message` | è·å–ä¸å‘é€å•èŠã€ç¾¤ç»„æ¶ˆæ¯ |
| `im:message:send_as_bot` | ä»¥åº”ç”¨çš„èº«ä»½å‘é€æ¶ˆæ¯ |

### 3ï¸âƒ£ å¯ç”¨é•¿è¿æ¥

åœ¨ã€Œäº‹ä»¶è®¢é˜…ã€é¡µé¢ï¼š

1. æ‰¾åˆ°ã€Œä½¿ç”¨é•¿è¿æ¥æ¥æ”¶äº‹ä»¶ã€é€‰é¡¹
2. **å¼€å¯** æ­¤åŠŸèƒ½

> ğŸ’¡ **æç¤º**: ä½¿ç”¨é•¿è¿æ¥æ¨¡å¼æ— éœ€é…ç½®å›è°ƒåœ°å€ï¼Œè¿™æ˜¯æœ¬é¡¹ç›®çš„æ ¸å¿ƒä¼˜åŠ¿ï¼

### 4ï¸âƒ£ å‘å¸ƒåº”ç”¨

1. åœ¨ã€Œç‰ˆæœ¬ç®¡ç†ä¸å‘å¸ƒã€ä¸­åˆ›å»ºç‰ˆæœ¬
2. æäº¤å®¡æ ¸å¹¶å‘å¸ƒ

### 5ï¸âƒ£ åœ¨ç®¡ç†é¢æ¿ä¸­é…ç½®

1. **é£ä¹¦é…ç½®**: å¡«å…¥ App ID å’Œ App Secretï¼Œç‚¹å‡»ã€Œå¯åŠ¨è¿æ¥ã€
2. **Dify é…ç½®**: å¡«å…¥ Dify çš„ Base URL å’Œ API Key
3. **æ™ºèƒ½ä½“ç®¡ç†**: æ·»åŠ è‡³å°‘ä¸€ä¸ªæ™ºèƒ½ä½“

---

## ğŸ’¬ ä½¿ç”¨æ–¹æ³•

é…ç½®å®Œæˆåï¼Œç”¨æˆ·å¯ä»¥åœ¨é£ä¹¦ä¸­ä¸ Bot å¯¹è¯ï¼š

### å¯ç”¨å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `/help` æˆ– `å¸®åŠ©` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ |
| `/agent` æˆ– `é€‰æ‹©åŠ©æ‰‹` | åˆ‡æ¢ AI æ™ºèƒ½ä½“ |
| `/new` æˆ– `æ–°å¯¹è¯` | å¼€å§‹æ–°çš„å¯¹è¯ |

### å¯¹è¯æµç¨‹

1. ç”¨æˆ·åœ¨é£ä¹¦ä¸­æ‰¾åˆ° Bot å¹¶å‘é€æ¶ˆæ¯
2. é¦–æ¬¡å¯¹è¯ä¼šæç¤ºé€‰æ‹©æ™ºèƒ½ä½“ï¼ˆå¦‚æœæœ‰å¤šä¸ªï¼‰
3. é€‰æ‹©åå³å¯å¼€å§‹å¯¹è¯
4. å‘é€ `/new` å¯é‡ç½®å¯¹è¯ä¸Šä¸‹æ–‡

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
dify-feishu-bot/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ admin/              # ç®¡ç†é¢æ¿é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx        # ä»ªè¡¨ç›˜
â”‚   â”‚   â”‚   â”œâ”€â”€ feishu/         # é£ä¹¦é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ dify/           # Dify é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ agents/         # æ™ºèƒ½ä½“ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ conversations/  # ä¼šè¯è®°å½•
â”‚   â”‚   â””â”€â”€ api/admin/          # ç®¡ç† API
â”‚   â”œâ”€â”€ components/             # UI ç»„ä»¶
â”‚   â””â”€â”€ lib/                    # æ ¸å¿ƒé€»è¾‘
â”‚       â”œâ”€â”€ feishu.ts           # é£ä¹¦ SDK å°è£…
â”‚       â”œâ”€â”€ dify.ts             # Dify API å®¢æˆ·ç«¯
â”‚       â”œâ”€â”€ config.ts           # é…ç½®ç®¡ç†
â”‚       â”œâ”€â”€ db.ts               # æ•°æ®åº“æ“ä½œ
â”‚       â””â”€â”€ cards.ts            # å¡ç‰‡æ¶ˆæ¯æ¨¡æ¿
â”œâ”€â”€ config/
â”‚   â””â”€â”€ settings.json           # è¿è¡Œæ—¶é…ç½®
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma           # æ•°æ®åº“æ¨¡å‹
â””â”€â”€ .env                        # ç¯å¢ƒå˜é‡
```

---

## ğŸš¢ ç”Ÿäº§éƒ¨ç½²

### ä½¿ç”¨ PM2 éƒ¨ç½²

```bash
# æ„å»º
npm run build

# ä½¿ç”¨ PM2 å¯åŠ¨ï¼ˆå¿…é¡»ä½¿ç”¨é…ç½®æ–‡ä»¶æ¥åŠ è½½ .env ç¯å¢ƒå˜é‡ï¼‰
pm2 start ecosystem.config.js

# æŸ¥çœ‹æ—¥å¿—
pm2 logs dify-feishu-bot

# é‡å¯æœåŠ¡
pm2 restart dify-feishu-bot

# åœæ­¢æœåŠ¡
pm2 stop dify-feishu-bot
```

> âš ï¸ **é‡è¦**: PM2 é»˜è®¤ä¸ä¼šåŠ è½½ `.env` æ–‡ä»¶ï¼å¿…é¡»ä½¿ç”¨ `ecosystem.config.js` å¯åŠ¨ï¼Œå¦åˆ™ `ADMIN_TOKEN` ç­‰ç¯å¢ƒå˜é‡ä¸ä¼šç”Ÿæ•ˆã€‚

### ä½¿ç”¨ Docker éƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker build -t dify-feishu-bot .

# è¿è¡Œå®¹å™¨
docker run -d \
  -p 3000:3000 \
  -e ADMIN_TOKEN=your-token \
  -v $(pwd)/config:/app/config \
  -v $(pwd)/prisma:/app/prisma \
  dify-feishu-bot
```

---

## â“ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆé€‰æ‹© WebSocket é•¿è¿æ¥è€Œä¸æ˜¯ Webhookï¼Ÿ

**A:** WebSocket é•¿è¿æ¥æ¨¡å¼æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š
- æ— éœ€å…¬ç½‘ IP æˆ–åŸŸå
- æ— éœ€é…ç½®å›è°ƒ URL
- æœ¬åœ°å¼€å‘æ— éœ€å†…ç½‘ç©¿é€
- æ›´ç®€å•çš„éƒ¨ç½²æµç¨‹

### Q: æ”¯æŒç¾¤èŠå—ï¼Ÿ

**A:** ç›®å‰ä»…æ”¯æŒå•èŠåœºæ™¯ã€‚ç¾¤èŠæ”¯æŒè®¡åˆ’åœ¨åç»­ç‰ˆæœ¬ä¸­æ·»åŠ ã€‚

### Q: å¦‚ä½•æ›´æ–°é…ç½®ï¼Ÿ

**A:** åœ¨ Web ç®¡ç†é¢æ¿ä¸­ä¿®æ”¹é…ç½®åä¼šè‡ªåŠ¨ä¿å­˜ã€‚ä¿®æ”¹é£ä¹¦é…ç½®åéœ€è¦é‡æ–°ç‚¹å‡»ã€Œå¯åŠ¨è¿æ¥ã€ã€‚

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. åˆ›å»º Pull Request

---

## ğŸ“„ å¼€æºåè®®

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT åè®®](LICENSE) å¼€æºã€‚

---

## ğŸ™ è‡´è°¢

- [Dify](https://github.com/langgenius/dify) - å¼ºå¤§çš„ LLM åº”ç”¨å¼€å‘å¹³å°
- [é£ä¹¦å¼€æ”¾å¹³å°](https://open.feishu.cn/) - æä¾›å®Œå–„çš„ SDK æ”¯æŒ
- [Next.js](https://nextjs.org/) - ä¼˜ç§€çš„ React å…¨æ ˆæ¡†æ¶

---

<div align="center">

**å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸€ä¸ª â­ Star æ”¯æŒä¸€ä¸‹ï¼**

</div>
